<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Öffnungszeiten-Ampel</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f8f8f8;
      text-align: center;
    }
    .ampel-container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 40px;
    }
    .punkt {
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 1;
    }
    .punkt.vergessen {
      opacity: 0.4;
    }
    .kreis {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      font-size: 14px;
    }
    .datum {
      margin-top: 8px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>Öffnungszeiten-Ampel</h1>
  <div class="ampel-container" id="ampel"></div>

  <script>
    const sheetId = "1_-KJFMmaI7YNRvXh84RmB7Fz29mW4a6lFA7d_aVyFqaU";
    const sheetName = "Tabelle1";
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

    function formatDate(date) {
      const d = new Date(date);
      return d.toLocaleDateString("de-DE", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });
    }

    fetch(url)
      .then(res => res.text())
      .then(data => {
        const json = JSON.parse(data.substr(47).slice(0, -2));
        const rows = json.table.rows;
        const statusMap = {};
        for (let row of rows) {
          const date = row.c[0]?.v;
          const status = row.c[1]?.v;
          if (date && status) {
            statusMap[date] = status;
          }
        }

        const container = document.getElementById("ampel");
        const heute = new Date();

        for (let offset = -1; offset <= 1; offset++) {
          const d = new Date(heute);
          d.setDate(d.getDate() + offset);
          const datum = formatDate(d);
          const status = statusMap[datum] || "unbekannt";

          const punkt = document.createElement("div");
          punkt.className = "punkt" + (offset === -1 ? " vergessen" : "");

          const farbe = status.toLowerCase() === "geöffnet" ? "gold" :
                        status.toLowerCase() === "geschlossen" ? "black" : "gray";
          const text = status.toLowerCase() === "geöffnet" ? "open" :
                       status.toLowerCase() === "geschlossen" ? "closed" : "?";

          punkt.innerHTML = `
            <div class="kreis" style="background:${farbe}">${text}</div>
            <div class="datum">${datum.slice(0, 5)}${offset === 0 ? " (heute)" : ""}</div>
          `;

          container.appendChild(punkt);
        }
      })
      .catch(err => {
        console.error("Fehler beim Laden:", err);
        document.getElementById("ampel").innerHTML = "<p>Fehler beim Laden der Daten.</p>";
      });
  </script>
</body>
</html>
